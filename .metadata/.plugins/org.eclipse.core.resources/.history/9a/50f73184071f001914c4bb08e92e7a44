package com.bridgelabz.servlet;

import java.io.IOException;
import java.io.PrintWriter;
import java.sql.SQLException;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.bridgelabz.dbutil.UserDataBase;
import com.bridgelabz.model.UserInformation;

public class LoginPage extends HttpServlet{
	
	protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		UserInformation userInform=new UserInformation();
		userInform.setEmailId(req.getParameter("emailid"));
		userInform.setPassword(req.getParameter("password"));
		display(userInform);
		String email=req.getParameter("emailid");
		String pw=req.getParameter("password");
		if((RegistrationPage.userList.size()!=0)){
		for(UserInformation u:RegistrationPage.userList) 
		if(email.equalsIgnoreCase(u.getEmailId())&& pw.equalsIgnoreCase(u.getPassword()))
		{
			    PrintWriter out=resp.getWriter();
			    out.write("<html><body><div id='serlvetResponse' style='text-align: center;'>");
		        out.write("<h2>WELCOME  TO HOME PAGE</h2>");
		        out.write("<p style='color: green; font-size: large;'>Congratulations! <span style='text-transform: capitalize;'>" + u.getEmailId() + "</span>, You are an authorised login!</p>");
		        out.write("<p style='color: green; font-size: large;'>Congratulations! <span style='text-transform: capitalize;'>" + u.getPassword() + "</span>, You are password is!</p>");
		        out.write("</div></body></html>");
		        RequestDispatcher dis= req.getRequestDispatcher("/welcome.html");
				dis.forward(req, resp);
		        out.close();
		    	
		}
		GetDetails.getDetails();
		}
		
		try {
			UserInformation user=UserDataBase.reteriew(userInform);
			if(user==null) {
				RequestDispatcher dis= req.getRequestDispatcher("/login.html");
				dis.forward(req, resp);
		}
		if(email.equalsIgnoreCase(userInform.getEmailId())&&pw.equalsIgnoreCase(userInform.getPassword()))
		{
			RequestDispatcher dis= req.getRequestDispatcher("/welcome.html");
			dis.forward(req, resp);
		}
		}
		
		
		
		else
		{
			RequestDispatcher dis= req.getRequestDispatcher("/registration.html");
			dis.forward(req, resp);
		}
	}

	public UserInformation display( UserInformation userInform)
	{
		System.out.println("Mobile No  :" + userInform.getEmailId());
		System.out.println("Password   :" + userInform.getPassword());
		return userInform;
	}
}
